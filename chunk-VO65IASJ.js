import{a as d,b as S}from"./chunk-KUYOE2KN.js";import{Ea as c,Uc as o,Vc as h,Wc as u,Yc as E,_,ea as n}from"./chunk-GYX7HZX3.js";var r,m=(()=>{class i{static{this._CURRENT_USER_DATA_VERSION=3}static{this._USER_DATA_STORE_KEY="user-data"}static{this._SAVE_GAME_NAME_PREFIX="Save game "}#t;#e;#a;constructor(){this.userData=c({version:r._CURRENT_USER_DATA_VERSION,currentIndex:-1,data:[]}),this.currentIndex=E(()=>this.userData().currentIndex),this.#t=n(d),this.#e=n(S).getSettings().useBeta?"_beta":"_live",this.#a=h(()=>this.userData().data[this.currentIndex()]),u(()=>{let e=this.currentIndex();o(()=>{this.userData().currentIndex=e,this.save()})})}get currentData(){return this.#a}save(){this.#t.setItem(r._USER_DATA_STORE_KEY+this.#e,JSON.stringify(this.userData()))}read(){let e=this.#t.getItem(r._USER_DATA_STORE_KEY+this.#e);if(e){let t=JSON.parse(e),a=this.#r(t);this.userData.set(a),t.version!==a.version&&this.save()}else this.userData.set({version:r._CURRENT_USER_DATA_VERSION,currentIndex:0,data:[this.createEmptyUserData()]}),this.save()}delete(e){let t=e??this.currentIndex();this.currentIndex.update(a=>Math.max(0,a-1)),setTimeout(()=>{this.userData().data.splice(t,1),this.save()},0)}createEmptyUserData(e){return{name:e??this.#s(),myGuideFilter:{year:1,day:1,season:"Spring",weather:"Sunny",hideCompleted:!0},todoText:"",todos:[],checklists:{}}}#r(e){let t=e.data??[],a=e.version;for(;a!==r._CURRENT_USER_DATA_VERSION;)a?a===1?(t=t.map((s,R)=>(s.myGuideFilter={year:1,day:1,season:"Spring",weather:"Sunny",hideCompleted:!0},s.name=r._SAVE_GAME_NAME_PREFIX+(R+1),s.checklists={},s)),a=2):a===2&&(t=t.map(s=>(s.todoText="",s)),a=3):(t=[this.createEmptyUserData()],a=r._CURRENT_USER_DATA_VERSION);return{version:r._CURRENT_USER_DATA_VERSION,currentIndex:e.currentIndex??0,data:t}}#s(){let e=new Set(this.userData().data.map(a=>a.name)),t=this.userData().data.length+1;for(;e.has(r._SAVE_GAME_NAME_PREFIX+t);)t++;return r._SAVE_GAME_NAME_PREFIX+t}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=_({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();r=m;export{m as a};
