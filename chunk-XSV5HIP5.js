import{a as E}from"./chunk-EIGW5THG.js";import{f as _}from"./chunk-IIRYQ5NI.js";import{g as n}from"./chunk-SJRCRC22.js";import{a as f,b as l}from"./chunk-PYPF6S35.js";import{_ as m,ea as h,f as u}from"./chunk-J7WD3OMO.js";var a,g=(()=>{class c{static{this._CURRENT_TO_DO_VERSION=1}static{this._LEGACY_TO_DO_STORE_KEY="checklist"}#i;#e;#t;#r;constructor(){this.clearTimeout=3e3,this.userDataService=h(E),this.localStorage=h(f),this.#i=h(l),this.#e=new u,this.#t=new _(!0,[]),this.#r=this.#i.getSettings().useBeta?"_beta":"_live",this.read(),this.#t.compareWith=(t,e)=>t.category===e.category&&n(t.item)===n(e.item)}get currentToDoAmount(){return this.getCurrentToDo().length}get currentIsEmpty(){return this.currentToDoAmount===0}add(t){this.getCurrentToDo().push(t),this.save()}getCurrentToDo(){return this.userDataService.currentData().todos}save(){this.userDataService.save()}read(){let t=this.localStorage.getItem(a._LEGACY_TO_DO_STORE_KEY+this.#r);t&&this.#a(JSON.parse(t))}updateStatus(t,e,s,i=!1){let o={category:t,item:e};s?this.#t.select(o):this.#t.deselect(o),i?this.#o():this.#n()}resetLiveToDo(){this.localStorage.setItem(a._LEGACY_TO_DO_STORE_KEY+"_live",JSON.stringify([this.#s()])),this.read()}resetBetaToDo(){this.localStorage.setItem(a._LEGACY_TO_DO_STORE_KEY+"_beta",JSON.stringify([this.#s()])),this.read()}alreadyInList(t,e){let s=this.getCategoryList(t);if(s.length===0)return!1;let i=n(e);return!!s.find(o=>n(o.itemEntry)===i)}getCategoryList(t){return this.getCurrentToDo().filter(s=>s.context===t||t==="uncategorized"&&!s.context)}categoryCompleted$(){return this.#e.asObservable()}completeCategory(t){this.#e.next(t)}#n(){clearTimeout(this.clearTimer),this.clearTimer=setTimeout(()=>{this.#o()},this.clearTimeout)}#s(){return{version:a._CURRENT_TO_DO_VERSION,offerings:[],cookingRecipes:[],journal:{critter:[],fish:[],gems:[],artifacts:[],fossils:[],insects:[]},uncategorized:[]}}#o(){let t=this.#t.selected;this.#t.clear();let e=-1;t.forEach(s=>{let i=n(s.item);e=this.getCurrentToDo().findIndex(o=>n(o.itemEntry)===i&&o.context===s.category||s.category==="uncategorized"&&!o.context),e>=0&&this.getCurrentToDo().splice(e,1)}),this.save()}#a(t){return t.length?("version"in t[0]&&(t.forEach((e,s)=>{let i=[];e.cookingRecipes.forEach(r=>i.push({context:"cooking_recipes",itemEntry:r.item})),e.offerings.forEach(r=>i.push({context:"offerings",itemEntry:r.item,amount:r.amount,quality:r.quality})),e.uncategorized.forEach(r=>i.push({itemEntry:r})),e.journal.artifacts.forEach(r=>i.push({context:"journal_artifacts",itemEntry:r})),e.journal.gems.forEach(r=>i.push({context:"journal_gems",itemEntry:r})),e.journal.fossils.forEach(r=>i.push({context:"journal_fossils",itemEntry:r})),e.journal.critter.forEach(r=>i.push({context:"journal_critter",itemEntry:r.item})),e.journal.fish.forEach(r=>i.push({context:"journal_fish",itemEntry:r.item})),e.journal.insects.forEach(r=>i.push({context:"journal_insects",itemEntry:r.item}));let o=this.userDataService.userData().data[s];o&&(o.todos=i)}),this.localStorage.removeItem(a._LEGACY_TO_DO_STORE_KEY+this.#r),this.userDataService.save()),t):[]}static{this.\u0275fac=function(e){return new(e||c)}}static{this.\u0275prov=m({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})();a=g;export{g as a};
