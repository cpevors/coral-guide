import{B as f,T as _,q as n,u as h,v as l}from"./chunk-IYHG6KR3.js";import{ca as u,ia as c,j as m}from"./chunk-ZXANYF3K.js";var T=(()=>{class a{static{this._CURRENT_TO_DO_VERSION=1}static{this._LEGACY_TO_DO_STORE_KEY="checklist"}constructor(){this.clearTimeout=3e3,this.userDataService=c(_),this.localStorage=c(h),this._settings=c(l),this._completedCategory$=new m,this._markedAsCompleted=new f(!0,[]),this.versionSuffix=this._settings.getSettings().useBeta?"_beta":"_live",this.read(),this._markedAsCompleted.compareWith=(t,e)=>t.category===e.category&&n(t.item)===n(e.item)}get currentToDoAmount(){return this.getCurrentToDo().length}get currentIsEmpty(){return this.currentToDoAmount===0}add(t){this.getCurrentToDo().push(t),this.save()}getCurrentToDo(){return this.userDataService.getCurrentData().todos}save(){this.userDataService.save()}read(){let t=this.localStorage.getItem(a._LEGACY_TO_DO_STORE_KEY+this.versionSuffix);t&&this._migrate(JSON.parse(t))}updateStatus(t,e,s,i=!1){let o={category:t,item:e};s?this._markedAsCompleted.select(o):this._markedAsCompleted.deselect(o),i?this._completeEntries():this._resetClearTimer()}resetLiveToDo(){this.localStorage.setItem(a._LEGACY_TO_DO_STORE_KEY+"_live",JSON.stringify([this._createEmptyToDo()])),this.read()}resetBetaToDo(){this.localStorage.setItem(a._LEGACY_TO_DO_STORE_KEY+"_beta",JSON.stringify([this._createEmptyToDo()])),this.read()}alreadyInList(t,e){let s=this.getCategoryList(t);if(s.length===0)return!1;let i=n(e);return!!s.find(o=>n(o.itemEntry)===i)}getCategoryList(t){return this.getCurrentToDo().filter(s=>s.context===t||t==="uncategorized"&&!s.context)}categoryCompleted$(){return this._completedCategory$.asObservable()}completeCategory(t){this._completedCategory$.next(t)}_resetClearTimer(){clearTimeout(this.clearTimer),this.clearTimer=setTimeout(()=>{this._completeEntries()},this.clearTimeout)}_createEmptyToDo(){return{version:a._CURRENT_TO_DO_VERSION,offerings:[],cookingRecipes:[],journal:{critter:[],fish:[],gems:[],artifacts:[],fossils:[],insects:[]},uncategorized:[]}}_completeEntries(){let t=this._markedAsCompleted.selected;this._markedAsCompleted.clear();let e=-1;t.forEach(s=>{let i=n(s.item);e=this.getCurrentToDo().findIndex(o=>n(o.itemEntry)===i&&o.context===s.category||s.category==="uncategorized"&&!o.context),e>=0&&this.getCurrentToDo().splice(e,1)}),this.save()}_migrate(t){return t.length?("version"in t[0]&&(t.forEach((e,s)=>{let i=[];e.cookingRecipes.forEach(r=>i.push({context:"cooking_recipes",itemEntry:r.item})),e.offerings.forEach(r=>i.push({context:"offerings",itemEntry:r.item,amount:r.amount,quality:r.quality})),e.uncategorized.forEach(r=>i.push({itemEntry:r})),e.journal.artifacts.forEach(r=>i.push({context:"journal_artifacts",itemEntry:r})),e.journal.gems.forEach(r=>i.push({context:"journal_gems",itemEntry:r})),e.journal.fossils.forEach(r=>i.push({context:"journal_fossils",itemEntry:r})),e.journal.critter.forEach(r=>i.push({context:"journal_critter",itemEntry:r.item})),e.journal.fish.forEach(r=>i.push({context:"journal_fish",itemEntry:r.item})),e.journal.insects.forEach(r=>i.push({context:"journal_insects",itemEntry:r.item}));let o=this.userDataService.userData().data[s];o&&(o.todos=i)}),this.localStorage.removeItem(a._LEGACY_TO_DO_STORE_KEY+this.versionSuffix),this.userDataService.save()),t):[]}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{T as a};
